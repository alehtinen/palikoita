<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tekemistö</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#8b5cf6',
                    }
                }
            }
        }
    </script>
    <style>
        /* Tailwind JIT safelist - all possible dynamic color classes */
        .bg-blue-50,.bg-blue-100,.bg-blue-200,.bg-blue-500,.bg-blue-600,.bg-blue-700,.bg-blue-800,.bg-blue-900,
        .bg-purple-50,.bg-purple-100,.bg-purple-200,.bg-purple-500,.bg-purple-600,.bg-purple-700,.bg-purple-800,.bg-purple-900,
        .bg-green-50,.bg-green-100,.bg-green-200,.bg-green-500,.bg-green-600,.bg-green-700,.bg-green-800,.bg-green-900,
        .bg-red-50,.bg-red-100,.bg-red-200,.bg-red-500,.bg-red-600,.bg-red-700,.bg-red-800,.bg-red-900,
        .bg-yellow-50,.bg-yellow-100,.bg-yellow-200,.bg-yellow-500,.bg-yellow-600,.bg-yellow-700,.bg-yellow-800,.bg-yellow-900,
        .bg-orange-50,.bg-orange-100,.bg-orange-200,.bg-orange-500,.bg-orange-600,.bg-orange-700,.bg-orange-800,.bg-orange-900,
        .bg-pink-50,.bg-pink-100,.bg-pink-200,.bg-pink-500,.bg-pink-600,.bg-pink-700,.bg-pink-800,.bg-pink-900,
        .bg-indigo-50,.bg-indigo-100,.bg-indigo-200,.bg-indigo-500,.bg-indigo-600,.bg-indigo-700,.bg-indigo-800,.bg-indigo-900,
        .bg-cyan-50,.bg-cyan-100,.bg-cyan-200,.bg-cyan-500,.bg-cyan-600,.bg-cyan-700,.bg-cyan-800,.bg-cyan-900,
        .bg-teal-50,.bg-teal-100,.bg-teal-200,.bg-teal-500,.bg-teal-600,.bg-teal-700,.bg-teal-800,.bg-teal-900,
        .bg-gray-50,.bg-gray-100,.bg-gray-200,.bg-gray-500,.bg-gray-600,.bg-gray-700,.bg-gray-800,.bg-gray-900,
        .text-blue-200,.text-blue-400,.text-blue-600,.text-blue-800,
        .text-purple-200,.text-purple-400,.text-purple-600,.text-purple-800,
        .text-green-200,.text-green-400,.text-green-600,.text-green-800,
        .text-red-200,.text-red-400,.text-red-600,.text-red-800,
        .text-yellow-200,.text-yellow-400,.text-yellow-600,.text-yellow-800,
        .text-orange-200,.text-orange-400,.text-orange-600,.text-orange-800,
        .text-pink-200,.text-pink-400,.text-pink-600,.text-pink-800,
        .text-indigo-200,.text-indigo-400,.text-indigo-600,.text-indigo-800,
        .text-cyan-200,.text-cyan-400,.text-cyan-600,.text-cyan-800,
        .text-teal-200,.text-teal-400,.text-teal-600,.text-teal-800,
        .text-gray-200,.text-gray-400,.text-gray-600,.text-gray-800,
        .hover\:bg-blue-100,.hover\:bg-blue-700,.hover\:bg-blue-900,
        .hover\:bg-purple-100,.hover\:bg-purple-700,.hover\:bg-purple-900,
        .hover\:bg-green-100,.hover\:bg-green-700,.hover\:bg-green-900,
        .hover\:bg-red-100,.hover\:bg-red-700,.hover\:bg-red-900,
        .hover\:bg-yellow-100,.hover\:bg-yellow-700,.hover\:bg-yellow-900,
        .hover\:bg-orange-100,.hover\:bg-orange-700,.hover\:bg-orange-900,
        .hover\:bg-pink-100,.hover\:bg-pink-700,.hover\:bg-pink-900,
        .hover\:bg-indigo-100,.hover\:bg-indigo-700,.hover\:bg-indigo-900,
        .hover\:bg-cyan-100,.hover\:bg-cyan-700,.hover\:bg-cyan-900,
        .hover\:bg-teal-100,.hover\:bg-teal-700,.hover\:bg-teal-900,
        .dark\:bg-blue-900,.dark\:bg-purple-900,.dark\:bg-green-900,.dark\:bg-red-900,.dark\:bg-yellow-900,
        .dark\:bg-orange-900,.dark\:bg-pink-900,.dark\:bg-indigo-900,.dark\:bg-cyan-900,.dark\:bg-teal-900,
        .dark\:text-blue-200,.dark\:text-purple-200,.dark\:text-green-200,.dark\:text-red-200,
        .dark\:text-yellow-200,.dark\:text-orange-200,.dark\:text-pink-200,.dark\:text-indigo-200,
        .dark\:text-cyan-200,.dark\:text-teal-200,
        .dark\:hover\:bg-blue-900,.dark\:hover\:bg-purple-900,.dark\:hover\:bg-green-900,
        .dark\:hover\:bg-red-900,.dark\:hover\:bg-yellow-900,.dark\:hover\:bg-orange-900,
        .ring-2,.ring-blue-500,.ring-purple-500,.ring-green-500,.ring-red-500,.ring-yellow-500,
        .ring-orange-500,.ring-pink-500,.ring-indigo-500,.ring-cyan-500,.ring-teal-500,
        .border-blue-500,.border-purple-500,.border-green-500,.border-red-500,.border-yellow-500,
        .border-orange-500,.border-pink-500,.border-indigo-500,.border-cyan-500,.border-teal-500,
        .hover\:border-blue-500,.hover\:border-purple-500,.hover\:border-green-500,
        .hover\:text-blue-300,.hover\:text-blue-700,.hover\:text-purple-300,.hover\:text-purple-700,
        .dark\:hover\:text-blue-300,.dark\:hover\:text-purple-300 { }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 min-h-screen transition-colors duration-200 overflow-x-hidden">
    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-wrap justify-between items-center py-4 gap-4">
                <div class="min-w-0">
                    <a href="index.html" class="hover:opacity-80 transition-opacity">
                        <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900 dark:text-white">
                            Tekemistö
                        </h1>
                    </a>
                    <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1" id="categorySubtitle">
                        <!-- Filled by JavaScript -->
                    </p>
                </div>
                <div class="flex items-center gap-1 sm:gap-2 flex-wrap">
                    <!-- Bookmarks Download -->
                    <button onclick="showExportModal('bookmark')" class="px-2 sm:px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium flex items-center gap-1 transition-colors text-xs sm:text-sm">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                        </svg>
                        <span class="hidden sm:inline lang-fi">Kirjanmerkit</span>
                        <span class="hidden sm:inline lang-en">Bookmarks</span>
                    </button>
                    
                    <!-- Combined PDF Download -->
                    <button onclick="showExportModal('pdf')" class="px-2 sm:px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium flex items-center gap-1 transition-colors text-xs sm:text-sm">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <span class="lang-fi">PDF</span>
                        <span class="lang-en hidden">PDF</span>
                    </button>
                    
                    <!-- ZIP Download -->
                    <button onclick="showExportModal('zip')" class="px-2 sm:px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium flex items-center gap-1 transition-colors text-xs sm:text-sm">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
                        </svg>
                        <span class="lang-fi">ZIP</span>
                        <span class="lang-en hidden">ZIP</span>
                    </button>
                    
                    <button id="langToggle" class="px-2 sm:px-3 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium text-xs sm:text-sm">
                        EN
                    </button>
                    <button id="themeToggle" class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="border-t border-gray-200 dark:border-gray-700 py-3">
                <div class="flex gap-4" id="categoryNav">
                    <!-- Filled by JavaScript -->
                </div>
            </nav>
        </div>
    </header>

    <!-- Export Selection Modals -->
    <div id="pdfModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                <span class="lang-fi">Lataa PDF</span>
                <span class="lang-en">Download PDF</span>
            </h3>
            <p class="text-gray-600 dark:text-gray-400 mb-4">
                <span class="lang-fi">Luo PDF-tiedosto valituista kategorioista. Sisältää kaikki tiedot, linkit ja kuvaukset.</span>
                <span class="lang-en">Create a PDF file from selected categories. Includes all information, links and descriptions.</span>
            </p>
            <div class="space-y-2 mb-6" id="pdfCategories"></div>
            <div class="flex gap-2 justify-end">
                <button onclick="closeExportModal('pdf')" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                    <span class="lang-fi">Peruuta</span>
                    <span class="lang-en">Cancel</span>
                </button>
                <button onclick="confirmPdfDownload()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                    <span class="lang-fi">Lataa PDF</span>
                    <span class="lang-en">Download PDF</span>
                </button>
            </div>
        </div>
    </div>

    <div id="zipModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                <span class="lang-fi">Lataa ZIP</span>
                <span class="lang-en">Download ZIP</span>
            </h3>
            <p class="text-gray-600 dark:text-gray-400 mb-4">
                <span class="lang-fi">Luo ZIP-arkisto, joka sisältää erillisen PDF:n jokaisesta valitusta kategoriasta sekä yhdistetyn PDF:n kaikista.</span>
                <span class="lang-en">Create a ZIP archive containing separate PDFs for each selected category plus a combined PDF of all.</span>
            </p>
            <div class="space-y-2 mb-4" id="zipCategories"></div>
            <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mb-6">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="zipIncludeCombined" checked class="w-4 h-4 text-purple-600 rounded">
                    <span class="text-gray-900 dark:text-white font-medium">
                        <span class="lang-fi">Sisällytä yhdistetty PDF (kaikki kategoriat yhdessä tiedostossa)</span>
                        <span class="lang-en">Include combined PDF (all categories in one file)</span>
                    </span>
                </label>
            </div>
            <div class="flex gap-2 justify-end">
                <button onclick="closeExportModal('zip')" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                    <span class="lang-fi">Peruuta</span>
                    <span class="lang-en">Cancel</span>
                </button>
                <button onclick="confirmZipDownload()" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors">
                    <span class="lang-fi">Lataa ZIP</span>
                    <span class="lang-en">Download ZIP</span>
                </button>
            </div>
        </div>
    </div>

    <div id="bookmarkModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
                <span class="lang-fi">Lataa Kirjanmerkit</span>
                <span class="lang-en">Download Bookmarks</span>
            </h3>
            <p class="text-gray-600 dark:text-gray-400 mb-4">
                <span class="lang-fi">Vie linkit HTML-kirjanmerkkitiedostona, jonka voi tuoda selaimeen. Sisältää kansiorakenteen kategorioittain.</span>
                <span class="lang-en">Export links as HTML bookmarks file that can be imported to your browser. Includes folder structure by category.</span>
            </p>
            <div class="space-y-2 mb-6" id="bookmarkCategories"></div>
            <div class="flex gap-2 justify-end">
                <button onclick="closeExportModal('bookmark')" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                    <span class="lang-fi">Peruuta</span>
                    <span class="lang-en">Cancel</span>
                </button>
                <button onclick="confirmBookmarkDownload()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                    <span class="lang-fi">Lataa Kirjanmerkit</span>
                    <span class="lang-en">Download Bookmarks</span>
                </button>
            </div>
        </div>
    </div>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Category Content Section -->
        <div class="bg-white/50 dark:bg-gray-800/50 backdrop-blur-sm rounded-2xl shadow-xl p-8">
            <!-- Header with controls -->
            <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white" id="categoryTitle">
                    <!-- Filled by JavaScript -->
                </h2>
                <div class="flex gap-2 items-center flex-wrap">
                    <!-- Category Bookmarks Download -->
                    <button onclick="downloadCategoryBookmarks()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium flex items-center gap-2 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
                        </svg>
                        <span class="lang-fi">Kirjanmerkit</span>
                        <span class="lang-en hidden">Bookmarks</span>
                    </button>
                    
                    <!-- Category PDF Download -->
                    <button onclick="downloadCategoryPDF()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium flex items-center gap-2 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <span class="lang-fi">Lataa kategoria PDF</span>
                        <span class="lang-en hidden">Download category PDF</span>
                    </button>
                    
                    <!-- Sorting Burger Menu -->
                    <div class="relative">
                        <button id="sortMenuBtn" onclick="toggleSortMenu()" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg font-medium flex items-center gap-2 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                            <span class="lang-fi">Järjestä</span>
                            <span class="lang-en hidden">Sort</span>
                        </button>
                        <div id="sortMenu" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 z-10">
                            <button data-sort="default" onclick="changeSortMode('default')" class="sort-menu-item w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-t-lg text-gray-900 dark:text-white">
                                <span class="lang-fi">Oletus</span>
                                <span class="lang-en hidden">Default</span>
                            </button>
                            <button data-sort="date" onclick="changeSortMode('date')" class="sort-menu-item w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-900 dark:text-white">
                                <span class="lang-fi">Päivämäärä</span>
                                <span class="lang-en hidden">Date</span>
                            </button>
                            <button data-sort="alphabetical" onclick="changeSortMode('alphabetical')" class="sort-menu-item w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-900 dark:text-white">
                                <span class="lang-fi">Aakkosjärjestys</span>
                                <span class="lang-en hidden">Alphabetical</span>
                            </button>
                            <button data-sort="tags" onclick="changeSortMode('tags')" class="sort-menu-item w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-b-lg text-gray-900 dark:text-white">
                                <span class="lang-fi">Tagit</span>
                                <span class="lang-en hidden">Tags</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- View Toggle -->
                    <button id="viewToggle" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg font-medium flex items-center gap-2 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                        <!-- Filled by JavaScript -->
                    </button>
                </div>
            </div>

            <!-- Search Bar -->
            <div class="mb-6">
                <input 
                    type="text" 
                    id="searchInput" 
                    class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
                    placeholder="">
            </div>

            <!-- Tag Filters -->
            <div class="mb-6">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                        <span class="lang-fi">Suodata tageilla:</span>
                        <span class="lang-en hidden">Filter by tags:</span>
                    </h3>
                    <button id="multiSelectToggle" class="px-3 py-1 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm font-medium">
                        <span class="lang-fi">Valitse useita</span>
                        <span class="lang-en hidden">Multi-select</span>
                    </button>
                </div>
                <div id="tagFilters" class="flex flex-wrap gap-2">
                    <!-- Tags will be inserted here by JavaScript -->
                </div>
            </div>

            <!-- Results Count -->
            <div class="mb-4">
                <p id="resultCount" class="text-sm text-gray-600 dark:text-gray-400">
                    <!-- Filled by JavaScript -->
                </p>
            </div>

            <!-- Content Grid -->
            <div id="allContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Content will be inserted here by JavaScript -->
            </div>
        </div>
    </main>

    <!-- Tip Modal -->
    <div id="tipModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-75" onclick="closeTipModal()"></div>
            
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-6 pt-5 pb-4">
                    <div class="flex justify-between items-start mb-4">
                        <h3 id="modalTitle" class="text-2xl font-bold text-gray-900 dark:text-white"></h3>
                        <button onclick="closeTipModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="mt-3">
                        <p id="modalDescription" class="text-gray-600 dark:text-gray-300 mb-4"></p>
                        <div id="modalBody"></div>
                        <div class="flex flex-wrap gap-2 mb-4" id="modalTags"></div>
                        <div id="modalLinks"></div>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-4" id="modalDate"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Scripts -->
    <script src="loader.js"></script>
    <script src="app.js"></script>
    <script>
        // Get category from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const categoryId = urlParams.get('category');
        
        // Generate navigation menu
        function generateCategoryNav() {
            const nav = document.getElementById('categoryNav');
            if (!nav || !window.mainTagDefinitions) return;
            
            nav.innerHTML = '';
            
            // Add "All" link
            const allLink = document.createElement('a');
            allLink.href = 'index.html';
            allLink.className = 'px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors font-medium';
            allLink.innerHTML = '<span class="lang-fi">← Kaikki</span><span class="lang-en hidden">← All</span>';
            nav.appendChild(allLink);
            
            // Add category links
            Object.keys(window.mainTagDefinitions).forEach(mainTagId => {
                const mainTagDef = window.mainTagDefinitions[mainTagId];
                const link = document.createElement('a');
                link.href = `category.html?category=${mainTagId}`;
                
                if (mainTagId === categoryId) {
                    link.className = 'px-4 py-2 rounded-lg bg-primary text-white font-medium';
                } else {
                    link.className = 'px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors font-medium';
                }
                
                link.textContent = mainTagDef[currentLang];
                nav.appendChild(link);
            });
        }
        
        // Initialize the page when content is loaded
        window.addEventListener('contentLoaded', (e) => {
            window.contentData = e.detail.content;
            window.mainTagDefinitions = e.detail.mainTagDefinitions;
            window.tagDefinitions = e.detail.tagDefinitions;
            
            // Set current main tag from URL
            if (categoryId && window.mainTagDefinitions[categoryId]) {
                currentMainTag = categoryId;
                const categoryDef = window.mainTagDefinitions[categoryId];
                
                // Update page title and subtitle
                document.title = `${categoryDef[currentLang]} - Tekemistö`;
                document.getElementById('categoryTitle').textContent = categoryDef[currentLang];
                document.getElementById('categorySubtitle').textContent = categoryDef[currentLang];
            } else {
                // No valid category, redirect to home
                window.location.href = 'index.html';
                return;
            }
            
            initializePage();
            generateCategoryNav();
            renderTagFilters();
            renderContent();
        });
        
        // Download PDF for current category
        function downloadCategoryPDF() {
            if (currentMainTag) {
                downloadMainTagPDF(currentMainTag);
            }
        }
    </script>

    <!-- Footer -->
    <footer class="bg-gray-100 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <p class="text-center text-sm text-gray-600 dark:text-gray-400">
                <span data-lang="fi">Päivitetty viimeksi: 24.1.2026</span>
                <span data-lang="en">Last updated: 24.1.2026</span>
            </p>
        </div>
    </footer>
</body>
</html>
